<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.depression.dao.CapitalIncomeExpensesMapper">
  <resultMap id="BaseResultMap" type="com.depression.model.CapitalIncomeExpenses">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    <id column="ieid" jdbcType="BIGINT" property="ieid" />
    <result column="no" jdbcType="VARCHAR" property="no" />
    <result column="order_no" jdbcType="VARCHAR" property="orderNo" />
    <result column="mid" jdbcType="BIGINT" property="mid" />
    <result column="amount" jdbcType="DECIMAL" property="amount" />
    <result column="cash_balance" jdbcType="DECIMAL" property="cashBalance" />
    <result column="pingxx_pay_id" jdbcType="VARCHAR" property="pingxxPayId" />
    <result column="items" jdbcType="TINYINT" property="items" />
    <result column="direction" jdbcType="TINYINT" property="direction" />
    <result column="channel" jdbcType="TINYINT" property="channel" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="finish_time" jdbcType="TIMESTAMP" property="finishTime" />
    <result column="is_delete" jdbcType="TINYINT" property="isDelete" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    ieid, no, order_no, mid, amount, cash_balance, pingxx_pay_id, items, direction, channel, 
    status, remark, create_time, finish_time, is_delete
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from capital_income_expenses
    where ieid = #{ieid,jdbcType=BIGINT}
    and is_delete = 0
  </select>
  <insert id="insert" keyProperty="ieid" parameterType="com.depression.model.CapitalIncomeExpenses" useGeneratedKeys="true">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    insert into capital_income_expenses (ieid, no, order_no, 
      mid, amount, cash_balance, 
      pingxx_pay_id, items, direction, 
      channel, status, remark, 
      create_time, finish_time, is_delete
      )
    values (#{ieid,jdbcType=BIGINT}, #{no,jdbcType=VARCHAR}, #{orderNo,jdbcType=VARCHAR}, 
      #{mid,jdbcType=BIGINT}, #{amount,jdbcType=DECIMAL}, #{cashBalance,jdbcType=DECIMAL}, 
      #{pingxxPayId,jdbcType=VARCHAR}, #{items,jdbcType=TINYINT}, #{direction,jdbcType=TINYINT}, 
      #{channel,jdbcType=TINYINT}, #{status,jdbcType=TINYINT}, #{remark,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{finishTime,jdbcType=TIMESTAMP}, #{isDelete,jdbcType=TINYINT}
      )
  </insert>
  <insert id="insertSelective" keyProperty="ieid" parameterType="com.depression.model.CapitalIncomeExpenses" useGeneratedKeys="true">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    insert into capital_income_expenses
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="ieid != null">
        ieid,
      </if>
      <if test="no != null">
        no,
      </if>
      <if test="orderNo != null">
        order_no,
      </if>
      <if test="mid != null">
        mid,
      </if>
      <if test="amount != null">
        amount,
      </if>
      <if test="cashBalance != null">
        cash_balance,
      </if>
      <if test="pingxxPayId != null">
        pingxx_pay_id,
      </if>
      <if test="items != null">
        items,
      </if>
      <if test="direction != null">
        direction,
      </if>
      <if test="channel != null">
        channel,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="finishTime != null">
        finish_time,
      </if>
      <if test="isDelete != null">
        is_delete,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="ieid != null">
        #{ieid,jdbcType=BIGINT},
      </if>
      <if test="no != null">
        #{no,jdbcType=VARCHAR},
      </if>
      <if test="orderNo != null">
        #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="mid != null">
        #{mid,jdbcType=BIGINT},
      </if>
      <if test="amount != null">
        #{amount,jdbcType=DECIMAL},
      </if>
      <if test="cashBalance != null">
        #{cashBalance,jdbcType=DECIMAL},
      </if>
      <if test="pingxxPayId != null">
        #{pingxxPayId,jdbcType=VARCHAR},
      </if>
      <if test="items != null">
        #{items,jdbcType=TINYINT},
      </if>
      <if test="direction != null">
        #{direction,jdbcType=TINYINT},
      </if>
      <if test="channel != null">
        #{channel,jdbcType=TINYINT},
      </if>
      <if test="status != null">
        #{status,jdbcType=TINYINT},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="finishTime != null">
        #{finishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null">
        #{isDelete,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>
  <select id="selectByPrimaryKeyLock" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    select * from capital_income_expenses
    where ieid = #{ieid,jdbcType=BIGINT}
    and is_delete = 0
    for update
  </select>
  <select id="selectByPrimaryKeyBulk" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    select * from capital_income_expenses
    where ieid in
    <foreach close=")" collection="ids" index="index" item="item" open="(" separator=",">
      #{item}
    </foreach>
    and is_delete = 0
  </select>
  <update id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    update capital_income_expenses
    set is_delete = 1
    where ieid = #{ieid,jdbcType=BIGINT}
  </update>
  <update id="deleteByPrimaryKeyBulk" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    update capital_income_expenses
    set is_delete = 1
    where ieid in
    <foreach close=")" collection="ids" index="index" item="item" open="(" separator=",">
      #{item}
    </foreach>
  </update>
  <update id="updateByPrimaryKey" parameterType="com.depression.model.CapitalIncomeExpenses">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    update capital_income_expenses
    set no = #{no,jdbcType=VARCHAR},
      order_no = #{orderNo,jdbcType=VARCHAR},
      mid = #{mid,jdbcType=BIGINT},
      amount = #{amount,jdbcType=DECIMAL},
      cash_balance = #{cashBalance,jdbcType=DECIMAL},
      pingxx_pay_id = #{pingxxPayId,jdbcType=VARCHAR},
      items = #{items,jdbcType=TINYINT},
      direction = #{direction,jdbcType=TINYINT},
      channel = #{channel,jdbcType=TINYINT},
      status = #{status,jdbcType=TINYINT},
      remark = #{remark,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      finish_time = #{finishTime,jdbcType=TIMESTAMP}
    where ieid = #{ieid,jdbcType=BIGINT}
    and is_delete = 0
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.depression.model.CapitalIncomeExpenses">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    update capital_income_expenses
    set no = #{no,jdbcType=VARCHAR},
      order_no = #{orderNo,jdbcType=VARCHAR},
      mid = #{mid,jdbcType=BIGINT},
      amount = #{amount,jdbcType=DECIMAL},
      cash_balance = #{cashBalance,jdbcType=DECIMAL},
      pingxx_pay_id = #{pingxxPayId,jdbcType=VARCHAR},
      items = #{items,jdbcType=TINYINT},
      direction = #{direction,jdbcType=TINYINT},
      channel = #{channel,jdbcType=TINYINT},
      status = #{status,jdbcType=TINYINT},
      remark = #{remark,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      finish_time = #{finishTime,jdbcType=TIMESTAMP}
    where ieid = #{ieid,jdbcType=BIGINT}
    and is_delete = 0
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.depression.model.CapitalIncomeExpenses">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    update capital_income_expenses
    <set>
      <if test="no != null">
        no = #{no,jdbcType=VARCHAR},
      </if>
      <if test="orderNo != null">
        order_no = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="mid != null">
        mid = #{mid,jdbcType=BIGINT},
      </if>
      <if test="amount != null">
        amount = #{amount,jdbcType=DECIMAL},
      </if>
      <if test="cashBalance != null">
        cash_balance = #{cashBalance,jdbcType=DECIMAL},
      </if>
      <if test="pingxxPayId != null">
        pingxx_pay_id = #{pingxxPayId,jdbcType=VARCHAR},
      </if>
      <if test="items != null">
        items = #{items,jdbcType=TINYINT},
      </if>
      <if test="direction != null">
        direction = #{direction,jdbcType=TINYINT},
      </if>
      <if test="channel != null">
        channel = #{channel,jdbcType=TINYINT},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=TINYINT},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="finishTime != null">
        finish_time = #{finishTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where ieid = #{ieid,jdbcType=BIGINT}
    and is_delete = 0
  </update>
  <select id="selectSelective" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    select * from capital_income_expenses
    <where>
      is_delete = 0
      <if test="no != null">
        and no = #{no,jdbcType=VARCHAR}
      </if>
      <if test="orderNo != null">
        and order_no = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="mid != null">
        and mid = #{mid,jdbcType=BIGINT}
      </if>
      <if test="amount != null">
        and amount = #{amount,jdbcType=DECIMAL}
      </if>
      <if test="cashBalance != null">
        and cash_balance = #{cashBalance,jdbcType=DECIMAL}
      </if>
      <if test="pingxxPayId != null">
        and pingxx_pay_id = #{pingxxPayId,jdbcType=VARCHAR}
      </if>
      <if test="items != null">
        and items = #{items,jdbcType=TINYINT}
      </if>
      <if test="direction != null">
        and direction = #{direction,jdbcType=TINYINT}
      </if>
      <if test="channel != null">
        and channel = #{channel,jdbcType=TINYINT}
      </if>
      <if test="status != null">
        and status = #{status,jdbcType=TINYINT}
      </if>
      <if test="remark != null">
        and remark = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null">
        and create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="finishTime != null">
        and finish_time = #{finishTime,jdbcType=TIMESTAMP}
      </if>
    </where>
  </select>
  <select id="selectSelectiveWithPage" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    select * from capital_income_expenses
    <where>
      is_delete = 0
      <if test="no != null">
        and no = #{no,jdbcType=VARCHAR}
      </if>
      <if test="orderNo != null">
        and order_no = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="mid != null">
        and mid = #{mid,jdbcType=BIGINT}
      </if>
      <if test="amount != null">
        and amount = #{amount,jdbcType=DECIMAL}
      </if>
      <if test="cashBalance != null">
        and cash_balance = #{cashBalance,jdbcType=DECIMAL}
      </if>
      <if test="pingxxPayId != null">
        and pingxx_pay_id = #{pingxxPayId,jdbcType=VARCHAR}
      </if>
      <if test="items != null">
        and items = #{items,jdbcType=TINYINT}
      </if>
      <if test="direction != null">
        and direction = #{direction,jdbcType=TINYINT}
      </if>
      <if test="channel != null">
        and channel = #{channel,jdbcType=TINYINT}
      </if>
      <if test="status != null">
        and status = #{status,jdbcType=TINYINT}
      </if>
      <if test="remark != null">
        and remark = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null">
        and create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="finishTime != null">
        and finish_time = #{finishTime,jdbcType=TIMESTAMP}
      </if>
    </where>
    limit #{pageStartNum},#{pageSize}
  </select>
  <select id="countSelective" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 14 14:21:36 CST 2016.
    -->
    select count(*) from capital_income_expenses
    <where>
      is_delete = 0
      <if test="no != null">
        and no = #{no,jdbcType=VARCHAR}
      </if>
      <if test="orderNo != null">
        and order_no = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="mid != null">
        and mid = #{mid,jdbcType=BIGINT}
      </if>
      <if test="amount != null">
        and amount = #{amount,jdbcType=DECIMAL}
      </if>
      <if test="cashBalance != null">
        and cash_balance = #{cashBalance,jdbcType=DECIMAL}
      </if>
      <if test="pingxxPayId != null">
        and pingxx_pay_id = #{pingxxPayId,jdbcType=VARCHAR}
      </if>
      <if test="items != null">
        and items = #{items,jdbcType=TINYINT}
      </if>
      <if test="direction != null">
        and direction = #{direction,jdbcType=TINYINT}
      </if>
      <if test="channel != null">
        and channel = #{channel,jdbcType=TINYINT}
      </if>
      <if test="status != null">
        and status = #{status,jdbcType=TINYINT}
      </if>
      <if test="remark != null">
        and remark = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null">
        and create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="finishTime != null">
        and finish_time = #{finishTime,jdbcType=TIMESTAMP}
      </if>
    </where>
  </select>
  
  <select id="selectWithPageByMid" resultType="com.depression.model.web.dto.CapitalIncomeExpensesDTO">
  	select 
  		cie.ieid,cie.`no`,cie.order_no orderNo,cie.create_time createTime,cie.amount,cie.items,cie.channel,cpa.cash_balance cashBalance,cpa.service_income_amount serviceIncomeAmount,cpa.expense_amount expenseAmount,cpa.withdraw_amount withdrawAmount 
  	from 
  		capital_income_expenses cie,member m,capital_personal_assets cpa
  	where cie.is_delete = 0 and cie.mid = #{mid} and cpa.mid = #{mid} and m.mid = #{mid} and items = #{items} and cie.status = 1
  	order by cie.finish_time
  	<if test="pageIndex != null and pageSize != null">
  		limit #{pageStartNum},#{pageSize}
  	</if>
  </select>
  
  <select id="selectCount" resultType="java.lang.Integer">
  	select count(*) from capital_income_expenses where is_delete = 0 and mid = #{mid} and items = #{items} and status = 1
  </select>
  
  <!-- 查询消费记录 -->
  <!-- <select id="selectWithPageExpenseRecordByMid" resultType="com.depression.model.web.dto.ExpensesRecordDTO">
  	select 
  		cie.ieid,cie.`no`,cie.create_time createTime,cie.amount,cie.items,cie.channel,m.nickname,so.practical_duration practicalDuration,cpa.cash_balance cashBalance,cpa.service_income_amount serviceIncomeAmount,cpa.expense_amount expenseAmount,cpa.withdraw_amount withdrawAmount
  	from 
  		capital_income_expenses cie, member m, service_order so ,capital_personal_assets cpa
  	where 
  		cie.is_delete = 0 and cie.mid = #{mid} and cie.mid = m.mid and cie.direction = 1 and so.`no` = cie.`no`
  	<if test="pageStartNum != null and pageSize != null">
  		limit #{pageStartNum},#{pageSize}
  	</if>
  </select> -->
  
  <select id="selectWithPageExpenseRecordByMid" resultType="com.depression.model.web.dto.ExpensesRecordDTO">
  	select cie.ieid,cie.`no`,cie.order_no orderNo,cie.create_time createTime,cie.amount,cie.items,cie.channel,
  	(select nickname from member where mid = (select so.service_provider_id from service_order so where cie.order_no = so.`no` and so.mid = #{mid})) nickname,
<!--   	(select sg.price from service_goods sg where sg.sgid = (select so.sgid from service_order so where cie.order_no = so.`no` and so.mid = #{mid})) orderPrice, -->
  	(select so.cost from service_order so where cie.order_no = so.`no` and so.mid = #{mid}) orderPrice,
	(select so.practical_duration from service_order so where cie.order_no = so.`no` and so.mid = #{mid}) practicalDuration,
	(select cpa.cash_balance from capital_personal_assets cpa where cpa.mid = #{mid}) cashBalance,
	(select cpa.service_income_amount from capital_personal_assets cpa where cpa.mid = #{mid}) serviceIncomeAmount,
	(select cpa.expense_amount from capital_personal_assets cpa where cpa.mid = #{mid}) expenseAmount,
	(select cpa.withdraw_amount from capital_personal_assets cpa where cpa.mid = #{mid}) withdrawAmount 
	from capital_income_expenses cie, member m where m.mid = cie.mid and m.mid = #{mid} and cie.direction = 1 and cie.is_delete = 0
	order by cie.finish_time desc
	<if test="pageStartNum != null and pageSize != null">
  		limit #{pageStartNum},#{pageSize}
  	</if>
  </select>
  
  <!-- 查询消费记录数量 -->
  <!-- <select id="selectExpenseRecordCount" resultType="java.lang.Integer">
  	select 
  		count(*)
  	from 
  		capital_income_expenses cie, member m, service_order so 
  	where 
  		cie.is_delete = 0 and cie.mid = #{mid} and cie.mid = m.mid and cie.direction = 1 and so.`no` = cie.`no`
  </select> -->
  <!-- 查询消费记录数量 -->
  <select id="selectExpenseRecordCount" resultType="java.lang.Integer">
  	select count(*) 
	from capital_income_expenses cie, member m where m.mid = cie.mid and m.mid = #{mid} and cie.direction = 1 and cie.is_delete = 0
  </select>
  
  <select id="selectSelectiveOrderByTimeWithPage" resultMap="BaseResultMap">
    select * from capital_income_expenses
    <where>
      is_delete = 0
      <if test="no != null">
        and no = #{no,jdbcType=VARCHAR}
      </if>
      <if test="orderNo != null">
        and order_no = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="mid != null">
        and mid = #{mid,jdbcType=BIGINT}
      </if>
      <if test="amount != null">
        and amount = #{amount,jdbcType=DECIMAL}
      </if>
      <if test="cashBalance != null">
        and cash_balance = #{cashBalance,jdbcType=DECIMAL}
      </if>
      <if test="pingxxPayId != null">
        and pingxx_pay_id = #{pingxxPayId,jdbcType=VARCHAR}
      </if>
      <if test="items != null">
        and items = #{items,jdbcType=TINYINT}
      </if>
      <if test="direction != null">
        and direction = #{direction,jdbcType=TINYINT}
      </if>
      <if test="channel != null">
        and channel = #{channel,jdbcType=TINYINT}
      </if>
      <if test="status != null">
        and status = #{status,jdbcType=TINYINT}
      </if>
      <if test="remark != null">
        and remark = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null">
        and create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="finishTime != null">
        and finish_time = #{finishTime,jdbcType=TIMESTAMP}
      </if>
    </where>
    order by create_time desc
    limit #{pageStartNum},#{pageSize}
  </select>
  
  	<select id="selectDateSet" resultType="String">
		select DATE_FORMAT(finish_time, '%Y%m%d') from capital_income_expenses
		where is_delete=0 and finish_time is not null group by DATE_FORMAT(finish_time, '%Y%m%d');
	</select>
	
	<select id="selectByDay" resultMap="BaseResultMap">
		select * from capital_income_expenses
		where is_delete=0 and finish_time is not null
		and #{day}=DATE_FORMAT(finish_time, '%Y%m%d')
	</select>
</mapper>
